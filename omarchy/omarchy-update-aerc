#!/bin/bash

# omarchy-update-aerc
# Updates aerc stylesets and applies the current theme

echo "Updating aerc stylesets..."

# Run the generator script
"$HOME/.local/share/omarchy/bin/omarchy-generate-aerc-styles"

# Copy all generated aerc.ini files to aerc stylesets directory
echo "Copying all aerc stylesets to aerc directory..."
for theme_dir in "$HOME/.config/omarchy/themes"/*; do
    if [[ -d "$theme_dir" ]]; then
        theme_name=$(basename "$theme_dir")
        if [[ -f "$theme_dir/aerc.ini" ]]; then
            cp "$theme_dir/aerc.ini" "$HOME/.config/aerc/stylesets/$theme_name"
            echo "  Copied $theme_name styleset"
        fi
    fi
done

# Get current theme and apply it
CURRENT_THEME=$(readlink "$HOME/.config/omarchy/current/theme" 2>/dev/null | xargs basename)

if [[ -n "$CURRENT_THEME" ]]; then
    echo "Applying current theme ($CURRENT_THEME) to aerc..."
    
    # Update aerc.conf to use the current theme
    sed -i "s/^styleset-name=.*/styleset-name=$CURRENT_THEME/" "$HOME/.config/aerc/aerc.conf"
    
    echo "Aerc theme updated to: $CURRENT_THEME"
else
    echo "Warning: No current theme found"
fi

echo "Done!"
